<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting Started · WaterModels</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="index.html"><img class="logo" src="assets/logo.svg" alt="WaterModels logo"/></a><h1>WaterModels</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Home</a></li><li><span class="toctext">Manual</span><ul><li class="current"><a class="toctext" href="quickguide.html">Getting Started</a><ul class="internal"><li><a class="toctext" href="#Installation-1">Installation</a></li><li><a class="toctext" href="#Solving-a-Network-Expansion-(or-Design)-Problem-1">Solving a Network Expansion (or Design) Problem</a></li><li><a class="toctext" href="#Obtaining-Results-1">Obtaining Results</a></li><li><a class="toctext" href="#Accessing-Different-Formulations-1">Accessing Different Formulations</a></li><li><a class="toctext" href="#Modifying-Network-Data-1">Modifying Network Data</a></li><li><a class="toctext" href="#Alternative-Methods-for-Building-and-Solving-Models-1">Alternative Methods for Building and Solving Models</a></li></ul></li><li><a class="toctext" href="network-data.html">Network Data Format</a></li><li><a class="toctext" href="result-data.html">Result Data Format</a></li><li><a class="toctext" href="math-model.html">Mathematical Models</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="formulations.html">Network Formulations</a></li><li><a class="toctext" href="specifications.html">Problem Specifications</a></li><li><span class="toctext">Modeling Components</span><ul><li><a class="toctext" href="model.html">WaterModel</a></li><li><a class="toctext" href="objective.html">Objective</a></li><li><a class="toctext" href="variables.html">Variables</a></li><li><a class="toctext" href="constraints.html">Constraints</a></li></ul></li><li><a class="toctext" href="relaxations.html">Relaxation Schemes</a></li><li><a class="toctext" href="parser.html">File I/O</a></li></ul></li><li><a class="toctext" href="developer.html">Developer</a></li><li><a class="toctext" href="experiment-results.html">Experiment Results</a></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href="quickguide.html">Getting Started</a></li></ul><a class="edit-page" href="https://github.com/lanl-ansi/WaterModels.jl/blob/master/docs/src/quickguide.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Getting Started</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Quick-Start-Guide-1" href="#Quick-Start-Guide-1">Quick Start Guide</a></h1><p>The following guide walks through the solution of a water network design problem using two mixed-integer linear programming formulations (MILP and MILP-R) of the network expansion (ne) problem specification. This is to enable solution using the readily-available open-source mixed-integer linear programming solver <a href="https://github.com/JuliaOpt/Cbc.jl">Cbc</a>. Other formulations rely on the availability of mixed-integer nonlinear programming solvers that support <a href="http://www.juliaopt.org/JuMP.jl/dev/nlp/#User-defined-Functions-1">user-defined nonlinear functions in JuMP</a>. However, these solvers (e.g., <a href="https://github.com/lanl-ansi/Juniper.jl">Juniper</a>, <a href="https://github.com/JuliaOpt/KNITRO.jl">KNITRO</a>) either require additional effort to register user-defined functions or are proprietary and require a commercial license.</p><h2><a class="nav-anchor" id="Installation-1" href="#Installation-1">Installation</a></h2><p>The latest stable release of WaterModels can be installed using the Julia package manager with</p><pre><code class="language-julia">] add WaterModels</code></pre><p>For the current development version, install the package using</p><pre><code class="language-julia">] add WaterModels#master</code></pre><p>Next, test that the package works by executing</p><pre><code class="language-julia">] test WaterModels</code></pre><p>Install <a href="https://github.com/JuliaOpt/Cbc.jl">Cbc</a> using</p><pre><code class="language-julia">] add Cbc</code></pre><p>Finally, install <a href="https://github.com/lanl-ansi/InfrastructureModels.jl">InfrastructureModels</a> using</p><pre><code class="language-julia">] add InfrastructureModels</code></pre><h2><a class="nav-anchor" id="Solving-a-Network-Expansion-(or-Design)-Problem-1" href="#Solving-a-Network-Expansion-(or-Design)-Problem-1">Solving a Network Expansion (or Design) Problem</a></h2><p>Once the above dependencies have been installed, obtain the files <a href="https://raw.githubusercontent.com/lanl-ansi/WaterModels.jl/master/test/data/epanet/shamir.inp"><code>shamir.inp</code></a> and <a href="https://raw.githubusercontent.com/lanl-ansi/WaterModels.jl/master/test/data/json/shamir.json"><code>shamir.json</code></a>. Here, <code>shamir.inp</code> is an EPANET file describing a simple seven-node, eight-link water distribution network with one reservoir, six junctions, and eight pipes. In accord, <code>shamir.json</code> is a JSON file specifying possible pipe diameters and associated costs per unit length, per diameter setting. The combination of data from these two files provides the required information to set up a corresponding network design problem, where the goal is to select the most cost-efficient pipe diameters while satisfying all demand in the network.</p><p>First, the diameter and cost data from the <code>shamir.json</code> problem specification must be appended to the initial data provided by the EPANET <code>shamir.inp</code> file. To read in the EPANET data, execute the following:</p><pre><code class="language-julia">using WaterModels
data = parse_file(&quot;shamir.inp&quot;)</code></pre><p>Next, to read in the JSON diameter and cost data, execute the following:</p><pre><code class="language-julia">modifications = parse_file(&quot;shamir.json&quot;)</code></pre><p>To merge these data together, InfrastructureModels is used to update the original network data using</p><pre><code class="language-julia">import InfrastructureModels
InfrastructureModels.update_data!(data, modifications)</code></pre><p>Finally, the MILP formulation for the network expansion specification can be solved using</p><pre><code class="language-julia">import JuMP
import Cbc

cbc = JuMP.with_optimizer(Cbc.Optimizer)
run_ne(data, MILPWaterModel, cbc)</code></pre><p>By default, only two breakpoints are used for the linear approximation of each head loss curve. These approximations can be more finely discretized by using additional arguments to the <code>run_ne</code> function. For example, to employ five breakpoints per head loss curve in this formulation, the following can be executed:</p><pre><code class="language-julia">run_ne(data, MILPWaterModel, cbc, ext=Dict(:num_breakpoints=&gt;5))</code></pre><p>Note that this takes much longer to solve due to the use of more binary variables. However, because of the finer discretization, a lower objective (design cost) can be obtained.</p><p>Instead of linear approximation, head loss curves can also be linearly outer-approximated via the MILP-R formulation. This formulation employs less strict requirements and avoids the use of binary variables, but solutions (e.g., diameters) may not necessarily be feasible with respect to the full (nonconvex) water network physics. To employ five outer-approximation points per (positive or negative) head loss curve in this formulation, the following can be executed</p><pre><code class="language-julia">run_ne(data, MILPRWaterModel, cbc, ext=Dict(:num_breakpoints=&gt;5))</code></pre><h2><a class="nav-anchor" id="Obtaining-Results-1" href="#Obtaining-Results-1">Obtaining Results</a></h2><p>The <code>run</code> commands in WaterModels return detailed results data in the form of a Julia <code>Dict</code>. This dictionary can be saved for further processing as follows:</p><pre><code class="language-julia">result = run_ne(data, MILPRWaterModel, cbc, ext=Dict(:num_breakpoints=&gt;5))</code></pre><p>For example, the algorithm&#39;s runtime and final objective value can be accessed with,</p><pre><code class="language-none">result[&quot;solve_time&quot;]
result[&quot;objective&quot;]</code></pre><p>The <code>&quot;solution&quot;</code> field contains detailed information about the solution produced by the <code>run</code> method. For example, the following dictionary comprehension can be used to inspect the flows in the solution:</p><pre><code class="language-none">Dict(name =&gt; data[&quot;q&quot;] for (name, data) in result[&quot;solution&quot;][&quot;pipe&quot;])</code></pre><p>Or, to obtain resistances (influenced by the selection of diameters):</p><pre><code class="language-none">Dict(name =&gt; data[&quot;r&quot;] for (name, data) in result[&quot;solution&quot;][&quot;pipe&quot;])</code></pre><p>For more information about WaterModels result data see the <a href="result-data.html#WaterModels-Result-Data-Format-1">WaterModels Result Data Format</a> section.</p><h2><a class="nav-anchor" id="Accessing-Different-Formulations-1" href="#Accessing-Different-Formulations-1">Accessing Different Formulations</a></h2><p>The MILP formulations discussed above assume access to a mixed-integer programming (MIP) solver. Mixed-integer nonconvex formulations can be solved with dedicated solvers, as well. For example, the full mixed-integer nonconvex formulation for network expansion (NCNLP) can be solved via</p><pre><code class="language-julia">import KNITRO

knitro = JuMP.with_optimizer(KNITRO.Optimizer)
run_ne(data, NCNLPWaterModel, knitro)</code></pre><p>and the mixed-integer convex formulation (MICP) can be solved via</p><pre><code class="language-julia">run_ne(data, MICPWaterModel, knitro)</code></pre><h2><a class="nav-anchor" id="Modifying-Network-Data-1" href="#Modifying-Network-Data-1">Modifying Network Data</a></h2><p>The following example demonstrates one way to perform multiple WaterModels solves while modifing network data in Julia.</p><pre><code class="language-julia">run_ne(data, MILPRWaterModel, cbc, ext=Dict(:num_breakpoints=&gt;5))

data[&quot;junction&quot;][&quot;3&quot;][&quot;demand&quot;] *= 2.0
data[&quot;junction&quot;][&quot;4&quot;][&quot;demand&quot;] *= 2.0
data[&quot;junction&quot;][&quot;5&quot;][&quot;demand&quot;] *= 2.0

run_ne(data, MILPRWaterModel, cbc, ext=Dict(:num_breakpoints=&gt;5))</code></pre><p>Note that the greater demands in the second problem result in an overall larger network cost. For additional details about the network data, see the <a href="network-data.html#WaterModels-Network-Data-Format-1">WaterModels Network Data Format</a> section.</p><h2><a class="nav-anchor" id="Alternative-Methods-for-Building-and-Solving-Models-1" href="#Alternative-Methods-for-Building-and-Solving-Models-1">Alternative Methods for Building and Solving Models</a></h2><p>The following example demonstrates how to break a <code>run_ne</code> call into separate model building and solving steps. This allows inspection of the JuMP model created by WaterModels for the problem.</p><pre><code class="language-julia">wm = build_model(data, MILPRWaterModel, WaterModels.post_ne)

print(wm.model)

result = optimize_model!(wm, cbc)</code></pre><footer><hr/><a class="previous" href="index.html"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="network-data.html"><span class="direction">Next</span><span class="title">Network Data Format</span></a></footer></article></body></html>
